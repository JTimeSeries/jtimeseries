<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
	     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	     xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">


    <bean id="serverMetricInitializer" class="com.od.jtimeseries.server.servermetrics.ServerMetricInitializer">
        <constructor-arg ref="rootContext"/>
        <constructor-arg>
            <list>
                <!-- A list of ServerMetricSource to supply server metric instances -->
                <!-- The following DefaultMetricSource defines some useful server monitoring metrics, but you could add other sources
                or define extra JmxMetric within this source to capture stats from third party processes which support jmx management service,
                for example -->
                <bean id="serverMetrics" class="com.od.jtimeseries.server.servermetrics.DefaultMetricSource">
                    <constructor-arg>
                        <!-- list of the default timeseries-server metrics -->
                        <list>

                            <!-- count of series gc'd for performance -->
                            <bean class="com.od.jtimeseries.server.servermetrics.GarbageCollectedSeriesMetric">
                                <constructor-arg value="${serverMetricsContextPath}"/>
                            </bean>

                            <!-- this jmx metric sums heap and non-heap memory from the timeseries server's own jmx management service -->
                            <bean class="com.od.jtimeseries.server.servermetrics.jmx.JmxMetric">
                                <!-- connect to jmx service to read memory every 5 mins -->
                                <constructor-arg><bean class="com.od.jtimeseries.util.time.Time" factory-method="minutes"><constructor-arg value="5"/></bean></constructor-arg>
                                <constructor-arg value="service:jmx:rmi:///jndi/rmi://localhost:${jmxManagementPort}/jmxrmi"/>
                                <constructor-arg>
                                    <bean class="com.od.jtimeseries.server.servermetrics.jmx.measurement.JmxMeasurements" factory-method="memoryUsage">
                                        <constructor-arg value="${serverMetricsContextPath}"/>
                                        <constructor-arg value="ServerMemory"/>
                                        <constructor-arg value="Heap and NonHeap Memory usage by server in MB"/>
                                    </bean>
                                </constructor-arg>
                            </bean>

                            <!-- running count of total series in server -->
                            <bean class="com.od.jtimeseries.server.servermetrics.TotalSeriesMetric">
                                <constructor-arg value="${serverMetricsContextPath}"/>
                                <constructor-arg ref="rootContext"/>
                            </bean>

                            <!-- running count of series for which server is currently receiving updates -->
                            <bean class="com.od.jtimeseries.server.servermetrics.LiveSeriesMetric">
                                <constructor-arg value="${serverMetricsContextPath}"/>
                            </bean>

                            <!-- Count of UDP updates received -->
                            <bean class="com.od.jtimeseries.server.servermetrics.UpdatesReceivedMetric">
                                <constructor-arg value="${serverMetricsContextPath}"/>
                            </bean>

                        </list>
                    </constructor-arg>
                </bean>
            </list>
        </constructor-arg>
        <constructor-arg>
            <bean class="com.od.jtimeseries.server.servermetrics.jmx.DefaultJmxExecutorService">
                <constructor-arg value="${jmxConnectionCountLimit}"/>
                <constructor-arg value="${jmxConnectionMaxAgeMillis}"/>
            </bean>
        </constructor-arg>
    </bean>
	
</beans>
